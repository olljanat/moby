#!/usr/bin/env bash
set -e
echo "WARNING: test-integration-cli is DEPRECATED. Use test-integration." >&2

# TODO: remove this and exit 1 once CI has changed to use test-integration
source hack/make/.integration-test-helpers

(
	build_legacy_test_suite_binaries
	bundle .integration-daemon-start
	bundle .integration-daemon-setup

	local testexit=0
	( repeat run_test_integration_legacy_suites ) || testexit=$?

	# Always run cleanup, even if the subshell fails
	bundle .integration-daemon-stop
	cleanup_test_suite_binaries
	error_on_leaked_containerd_shims

	exit $testexit

) 2>&1 | tee -a "$DEST/test-integration-cli.log"
